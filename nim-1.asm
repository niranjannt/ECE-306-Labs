.ORIG x3000

AND R1 R1 #0

ADD R1 R1 #1

ST R1 PLAYERSTATE

RESTART AND R0 R0 #0

AND R1 R1 #0

AND R2 R2 #0

AND R3 R3 #0

AND R4 R4 #0

AND R5 R5 #0

AND R6 R6 #0

AND R7 R7 #0

;initializes the state of the player
LD R1 PLAYERSTATE

NOT R1 R1

ST R1 PLAYERSTATE

LEA R2 INIT

JSR INIT_STATE


LEA R6 ROCKSCOUNT

ADD R5 R5 #-9

STR R5 R6 #0

AND R5 R5 #0

ADD R6 R6 #1

LEA R2 SECOND

JSR INIT_STATE



ADD R5 R5 #-8

STR R5 R6 #0

AND R5 R5 #0

ADD R6 R6 #1


AND R5 R5 #0

LEA R2 THIRD

;Prints initial state of game and determines rocks in each row for all three rows
JSR INIT_STATE

ADD R5 R5 #-8

STR R5 R6 #0

AND R5 R5 #0

ADD R6 R6 #1

ADD R1 R1 #-1

;changes state of the player

Brn STATECHANGE

LEA R2 PLAYER2_INPUT

Brnzp AGAIN

STATECHANGE LEA R2 PLAYER1_INPUT


;Stores ASCII input in RocksCount for comparison purposes
AGAIN JSR INIT_STATE

AND R5 R5 #0

AND R3 R3 #0

ADD R3 R3 #2

LOOP GETC 

OUT 

STR R0 R6 #0

ADD R6 R6 #1

ADD R3 R3 #-1

LEA R4 CHECK1

BRnp LOOP

Brz CHECK_VALIDATE

;Second letter load
CHECK_VALIDATE LDR R3 R6 #-2

ADD R5 R5 #1

LDR R1 R4 #0

Brz SECOND_LETTER

ADD R4 R4 #1

NOT R1 R1

ADD R1 R1 #1

ADD R2 R1 R3


Brnp CHECK_VALIDATE

Brz SECOND_LETTER




SECOND_LETTER ST R5 ROWWHICH

ADD R5 R5 #-1

Brz VALID

Brnp CHECKSAGAIN

;based on Value in R5 compares second letter in input


VALID LDR R2 R6 #-1

LDR R4 R6 #-5 

ADD R2 R2 #-10

ADD R2 R2 #-10

ADD R2 R2 #-10

ADD R2 R2 #-10

ADD R2 R2 #-8

ST R2 POP

Brnz INVALID_STATE


NOT R2 R2

ADD R2 R2 #1

ADD R3 R4 R2


Brzp NEXT_STATE

Brn INVALID_STATE

CHECKSAGAIN ADD R5 R5 #-1

Brz VALID2

Brnp CHECKSAGAIN2

VALID2 LDR R2 R6 #-1

LDR R4 R6 #-4

ADD R2 R2 #-10

ADD R2 R2 #-10

ADD R2 R2 #-10

ADD R2 R2 #-10

ADD R2 R2 #-8

ST R2 POP

Brnz INVALID_STATE

NOT R2 R2

ADD R2 R2 #1

ADD R3 R4 R2

Brzp NEXT_STATE

Brn INVALID_STATE


CHECKSAGAIN2 ADD R5 R5 #-1

Brz VALID3

Brnp INVALID_STATE

VALID3 LDR R2 R6 #-1

LDR R4 R6 #-3

ADD R2 R2 #-10

ADD R2 R2 #-10

ADD R2 R2 #-10

ADD R2 R2 #-10

ADD R2 R2 #-8

ST R2 POP

Brnz INVALID_STATE

NOT R2 R2

ADD R2 R2 #1

ADD R3 R4 R2

Brzp NEXT_STATE

Brn INVALID_STATE


NEXT_STATE LD R6 ROWWHICH

SUBTRACT ADD R6 R6 #-1

Brz FIRSTROW

ADD R6 R6 #-1

Brz SECONDROW

Brnzp THIRDROW


FIRSTROW LEA R2 SECOND

Brnzp ROW

SECONDROW LEA R2 THIRD

Brnzp ROW


THIRDROW LEA R2 PLAYER1_INPUT

LD R5 PLAYER1_INPUT

ROW LD R3 POP

SUB ADD R2 R2 #-1

ST R2 ADDRESS

LDI R5 ADDRESS

Brz SUB

POPAGAIN AND R4 R4 #0

REMOVE STR R4 R2 #0

ADD R3 R3 #-1

Brp POP_COUNTER

Brnz START

POP_COUNTER ADD R2 R2 #-1

Brnzp POPAGAIN



;prints current state
INIT_STATE LDR R0 R2 #0


Brnp JUMP

Brz BACK

JUMP ADD R5 R5 #1


ADD R2 R2 #1





PUTC

Brnzp INIT_STATE

BACK RET

INVALID_STATE LEA R2 INVALIDMOVE

JSR INIT_STATE

LD R1 PLAYERSTATE

Brn STATECHANGE2

LEA R2 PLAYER2_INPUT

JSR INIT_STATE


Brnzp PROMPT

STATECHANGE2 LEA R2 PLAYER1_INPUT

JSR INIT_STATE


Brnzp PROMPT

PROMPT AND R5 R5 #0

LEA R6 ROCKSCOUNT

ADD R6 R6 #3

AND R3 R3 #0

ADD R3 R3 #2

LOOP2 GETC 

OUT 

STR R0 R6 #0

ADD R6 R6 #1

ADD R3 R3 #-1

LEA R4 CHECK1

BRnp LOOP2

Brz CHECK_VALIDATE

;Checks for when the board of rocks is empty
START LDI R2 ZEROCHECK

Brnp RESTART

LDI R2 ZEROCHECK1

Brnp RESTART

LDI R2 ZEROCHECK2

Brnp RESTART

Brnzp WINNER
;loads winner based on state of game
WINNER LD R5 PLAYERSTATE

ST R5 PLAYERSTATE

ADD R5 R5 #-1

Brn STATECHANGE3

LEA R2 PLAYER1_WINS

JSR INIT_STATE

Brnzp FULLSTOP

STATECHANGE3 LEA R2 PLAYER2_WINS

JSR INIT_STATE

Brnzp FULLSTOP

FULLSTOP HALT

ROCKSCOUNT   .BLKW 6
PLAYERSTATE  .BLKW 1
ROCKSCOUNTADR .BLKW 1
CHECKADR     .BLKW 1
POP          .BLKW 1
ROWWHICH     .BLKW 1
ADDRESS      .BLKW 1
CHECK1        .STRINGZ "ABC"
PLAYER2_INPUT .STRINGZ "\nPlayer 2, choose a row and number of rocks: "
INIT .STRINGZ "\n\nROW A: ooo"
SECOND .STRINGZ "\nROW B: ooooo"
THIRD .STRINGZ "\nROW C: oooooooo"
PLAYER1_INPUT .STRINGZ "\nPlayer 1, choose a row and number of rocks: "
INVALIDMOVE   .STRINGZ "\nInvalid move. Try again."
PLAYER1_WINS  .STRINGZ "\n\nPlayer 1 Wins."
PLAYER2_WINS  .STRINGZ "\n\nPlayer 2 Wins."
ZEROCHECK     .FILL      x3101
ZEROCHECK1     .FILL      x310D
ZEROCHECK2     .FILL      x311B
.END